import { Link } from "react-router-dom";
import "../styles/navbar.css";
import { useEffect } from "react";
import { useState } from "react";
import axios from "axios";

function NavBar({ token, handleLogout, setLoading }) {
  const [firstname, setFirstname] = useState("");

  useEffect(() => {
    if (!token) return;
    const getName = async () => {
      try {
        const response = await axios.get("api/auth/me", {
          headers: { Authorization: `Bearer ${token}` },
        });
        setFirstname(response.data.first_name);
      } catch (error) {
        console.error("Lỗi khi tải dữ liệu người dùng:", error);
      }
    };
    getName();
  });

  return (
    <div className="NavBar">
      <nav className="aa">
        {token ? (
          <>
            <Link to="/">
              <svg
                width="50"
                height="50"
                viewBox="0 0 50 50"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M12.1875 35.625C13.9583 34.2708 15.9375 33.2031 18.125 32.4219C20.3125 31.6406 22.6042 31.25 25 31.25C27.3958 31.25 29.6875 31.6406 31.875 32.4219C34.0625 33.2031 36.0417 34.2708 37.8125 35.625C39.0278 34.2014 39.974 32.5868 40.651 30.7813C41.3281 28.9757 41.6667 27.0486 41.6667 25C41.6667 20.3819 40.0434 16.4497 36.7969 13.2031C33.5503 9.9566 29.6181 8.33333 25 8.33333C20.3819 8.33333 16.4497 9.9566 13.2031 13.2031C9.9566 16.4497 8.33333 20.3819 8.33333 25C8.33333 27.0486 8.67187 28.9757 9.34896 30.7813C10.026 32.5868 10.9722 34.2014 12.1875 35.625ZM25 27.0833C22.9514 27.0833 21.224 26.3802 19.8177 24.974C18.4115 23.5677 17.7083 21.8403 17.7083 19.7917C17.7083 17.7431 18.4115 16.0156 19.8177 14.6094C21.224 13.2031 22.9514 12.5 25 12.5C27.0486 12.5 28.776 13.2031 30.1823 14.6094C31.5885 16.0156 32.2917 17.7431 32.2917 19.7917C32.2917 21.8403 31.5885 23.5677 30.1823 24.974C28.776 26.3802 27.0486 27.0833 25 27.0833ZM25 45.8333C22.1181 45.8333 19.4097 45.2865 16.875 44.1927C14.3403 43.099 12.1354 41.6146 10.2604 39.7396C8.38542 37.8646 6.90104 35.6597 5.80729 33.125C4.71354 30.5903 4.16667 27.8819 4.16667 25C4.16667 22.1181 4.71354 19.4097 5.80729 16.875C6.90104 14.3403 8.38542 12.1354 10.2604 10.2604C12.1354 8.38542 14.3403 6.90104 16.875 5.80729C19.4097 4.71354 22.1181 4.16667 25 4.16667C27.8819 4.16667 30.5903 4.71354 33.125 5.80729C35.6597 6.90104 37.8646 8.38542 39.7396 10.2604C41.6146 12.1354 43.099 14.3403 44.1927 16.875C45.2865 19.4097 45.8333 22.1181 45.8333 25C45.8333 27.8819 45.2865 30.5903 44.1927 33.125C43.099 35.6597 41.6146 37.8646 39.7396 39.7396C37.8646 41.6146 35.6597 43.099 33.125 44.1927C30.5903 45.2865 27.8819 45.8333 25 45.8333Z"
                  fill="#1D1B20"
                />
              </svg>
            </Link>
            <p className="hello-user">Xin chào, {firstname}!</p>
            <button onClick={handleLogout}>Đăng xuất</button>
          </>
        ) : (
          <>
            <Link to="/">
              <svg
                width="50"
                height="50"
                viewBox="0 0 50 50"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M12.1875 35.625C13.9583 34.2708 15.9375 33.2031 18.125 32.4219C20.3125 31.6406 22.6042 31.25 25 31.25C27.3958 31.25 29.6875 31.6406 31.875 32.4219C34.0625 33.2031 36.0417 34.2708 37.8125 35.625C39.0278 34.2014 39.974 32.5868 40.651 30.7813C41.3281 28.9757 41.6667 27.0486 41.6667 25C41.6667 20.3819 40.0434 16.4497 36.7969 13.2031C33.5503 9.9566 29.6181 8.33333 25 8.33333C20.3819 8.33333 16.4497 9.9566 13.2031 13.2031C9.9566 16.4497 8.33333 20.3819 8.33333 25C8.33333 27.0486 8.67187 28.9757 9.34896 30.7813C10.026 32.5868 10.9722 34.2014 12.1875 35.625ZM25 27.0833C22.9514 27.0833 21.224 26.3802 19.8177 24.974C18.4115 23.5677 17.7083 21.8403 17.7083 19.7917C17.7083 17.7431 18.4115 16.0156 19.8177 14.6094C21.224 13.2031 22.9514 12.5 25 12.5C27.0486 12.5 28.776 13.2031 30.1823 14.6094C31.5885 16.0156 32.2917 17.7431 32.2917 19.7917C32.2917 21.8403 31.5885 23.5677 30.1823 24.974C28.776 26.3802 27.0486 27.0833 25 27.0833ZM25 45.8333C22.1181 45.8333 19.4097 45.2865 16.875 44.1927C14.3403 43.099 12.1354 41.6146 10.2604 39.7396C8.38542 37.8646 6.90104 35.6597 5.80729 33.125C4.71354 30.5903 4.16667 27.8819 4.16667 25C4.16667 22.1181 4.71354 19.4097 5.80729 16.875C6.90104 14.3403 8.38542 12.1354 10.2604 10.2604C12.1354 8.38542 14.3403 6.90104 16.875 5.80729C19.4097 4.71354 22.1181 4.16667 25 4.16667C27.8819 4.16667 30.5903 4.71354 33.125 5.80729C35.6597 6.90104 37.8646 8.38542 39.7396 10.2604C41.6146 12.1354 43.099 14.3403 44.1927 16.875C45.2865 19.4097 45.8333 22.1181 45.8333 25C45.8333 27.8819 45.2865 30.5903 44.1927 33.125C43.099 35.6597 41.6146 37.8646 39.7396 39.7396C37.8646 41.6146 35.6597 43.099 33.125 44.1927C30.5903 45.2865 27.8819 45.8333 25 45.8333Z"
                  fill="#1D1B20"
                />
              </svg>
            </Link>
            <Link to="/login">Đăng nhập</Link>
            <Link to="/register">Đăng ký</Link>
          </>
        )}
      </nav>
    </div>
  );
}

export default NavBar;
